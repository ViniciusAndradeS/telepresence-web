<!DOCTYPE HTML>
<html>

<head>
  <title>
    Telepresence Web
  </title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.css">
  <style>
    #publisherContainer.large {
      width: 640px;
      height: 480px;
    }
    
    #publisherContainer.small {
      width: 100px;
      height: 100px;
    }
  </style>
</head>

<body>

  <div id='subscriberDiv'>
    <div id='myPublisherDiv'>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12 col-lg-12 col-sm-12">
      <button class="col-md-6 col-lg-6 col-sm-6 btn btn-primary" id="y-positive">Y+</button>
      <button class="col-md-6 col-lg-6 col-sm-6 btn btn-primary" id="y-negative">Y-</button>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 col-lg-12 col-sm-12">
      <button class="col-md-6 col-lg-6 col-sm-6 btn btn-primary" id="x-positive">X+</button>
      <button class="col-md-6 col-lg-6 col-sm-6 btn btn-primary" id="x-negative">X-</button>
    </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="
    crossorigin="anonymous"></script>

  <script src="http://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
  <script src="https://static.opentok.com/v2/js/opentok.js" charset="utf-8"></script>
  <script charset="utf-8">
        var apiKey = '45633112';
        var sessionId = '2_MX40NTYzMzExMn5-MTQ3MDU4NTA4NTA0N35NeFAwNGdNazhvRVd1VE5ZL3ZJeUtlNDd-fg';
        var token = 'T1==cGFydG5lcl9pZD00NTYzMzExMiZzaWc9MTlmMWZhMmU4NDI3NzY0ZTc2YTRmMTcxMTdlMGFlYzA0OGVkYjI0ZTpzZXNzaW9uX2lkPTJfTVg0ME5UWXpNekV4TW41LU1UUTNNRFU0TlRBNE5UQTBOMzVOZUZBd05HZE5hemh2UlZkMVZFNVpMM1pKZVV0bE5EZC1mZyZjcmVhdGVfdGltZT0xNDcxOTA1MTEwJm5vbmNlPTAuODUyOTczMTg5MjA0OTMxMyZyb2xlPXB1Ymxpc2hlciZleHBpcmVfdGltZT0xNDc0NDk3MTA4';
        var subscriberOptions = {width: '100%', height: '100%', insertMode: 'append'};
        var publisherOptions = {width: '100%', height: '100%', insertMode: 'append'};
        var session = OT.initSession(apiKey, sessionId)
        .connect(token, function(error) {
          var publisher = OT.initPublisher('myPublisherDiv', publisherOptions);
          session.publish(publisher);
        })
        .on('streamCreated', function(event) {
          session.subscribe(event.stream, 'subscriberDiv', subscriberOptions);
        });

        document.addEventListener('keydown', function(event) {
          if(event.keyCode == 37) {
            alert('Left was pressed');
          }
          else if(event.keyCode == 38) {
            alert('Up was pressed');
          }
          else if(event.keyCode == 39) {
            alert('Right was pressed');
          }
          else if(event.keyCode == 40) {
            alert('Down was pressed');
          }
        });
  </script>
  <script>  
    $(function(){
      var API_ENDPOINT = 'http://telepresence-api.azurewebsites.net/api';
      var USER_ID = '90207322-d22c-455a-961e-e1df4d558dce';
      var ROBOT_ID = '287aa9c8-a165-4662-8201-623dec1ab43a';

      var service = {
        sendCommand: function(data){
          $.ajax({
            url: API_ENDPOINT + '/userrobot/' + ROBOT_ID,
            method: 'POST',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify(data),
            success: function(res){
              console.log(res);
              if(res.success)
                toastr.success('Comando enviado com sucesso');
              else
                toastr.error('Erro ao enviar o comando');

            },
            error: function(res){
              console.log(res);
              toastr.error('Erro ao enviar o comando');
            }
          });
        }
      };

      $('#x-positive').click(function(){
        service.sendCommand({
              axisX: 1,
              axisY: 0,
              userId: USER_ID
            });
      });

      $('#x-negative').click(function(){
        service.sendCommand({
              axisX: -1,
              axisY: 0,
              userId: USER_ID
            });
      });

      $('#y-positive').click(function(){
        service.sendCommand({
              axisX: 0,
              axisY: 1,
              userId: USER_ID
            });
      });

      $('#y-negative').click(function(){
        service.sendCommand({
              axisX: 0,
              axisY: -1,
              userId: USER_ID
            });
      });
    });
  </script>
</body>

</html>